import { useState, useEffect } from 'react';
import { Sparkles, Library, Send, Repeat, Check, X, ChevronDown } from 'lucide-react';

// Main App component
const App = () => {
  const [view, setView] = useState('notes'); // 'notes' or 'quiz'
  const [quizQuestions, setQuizQuestions] = useState([]);
  const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
  const [score, setScore] = useState(0);
  const [showResult, setShowResult] = useState(false);
  const [selectedAnswer, setSelectedAnswer] = useState(null);
  const [correctAnswer, setCorrectAnswer] = useState(null);
  const [isAnimating, setIsAnimating] = useState(false);

  // All your notes data
  const notesData = {
    august7: {
      title: "Donderdag 7 Augustus",
      sections: [
        {
          heading: "Emoties & Persoonsbeschrijving",
          items: [
            { text: "Samen (niet zamen)", translation: "Together" },
            { text: "Gek denken bestaat niet.", translation: "The phrase 'thinking crazy' doesn't exist." },
            { text: "Je bent gek.", translation: "You are crazy." },
            { text: "Wina had een gek plan / een rare gedachte hebben / deed iets raars.", translation: "Wina had a crazy plan / had a strange thought / did something strange." },
            { text: "Geloven", translation: "To believe" },
            { text: "Beleven = Meemaken", translation: "To experience" },
            { text: "Verkouden", translation: "To have a cold" },
            { text: "ZELFS als ik me beter VOEL", translation: "EVEN if I feel better" },
          ]
        },
        {
          heading: "Tijd & Handelingen",
          items: [
            { text: "Tijdens het koken", translation: "During the cooking" },
            { text: "Terwijl ik kook", translation: "While I cook" },
            { text: "DOE IK de afzuigkap aan", translation: "I turn on the extractor fan." },
            { text: "Morgen ga ik het ervan NEMEN.", translation: "Tomorrow I'm going to make the most of it." },
            { text: "Ik vind het niet leuk OM naar een begrafenis te gaan.", translation: "I don't like to go to a funeral." },
            { text: "Ik hou niet van begrafenissen.", translation: "I don't like funerals." },
            { text: "Wisselvallig weer", translation: "Changeable weather" },
            { text: "Dat betekent", translation: "That means" },
            { text: "Het wisselt continu.", translation: "It changes constantly." },
            { text: "Niet storen", translation: "Do not disturb" },
            { text: "Er vandoor gaan", translation: "To leave / to escape" },
            { text: "Een bezoek BIJ zijn oom (of met)", translation: "A visit AT his uncle's place (or with)" },
            { text: "Hij reed", translation: "He drove" },
            { text: "Opgehaald", translation: "Picked up" },
            { text: "Succes met de twee vluchten.", translation: "Good luck with the two flights." },
          ]
        },
        {
          heading: "Plaatsen & Objecten",
          items: [
            { text: "Steden - Stad", translation: "Cities / City" },
            { text: "Podium", translation: "Stage" },
            { text: "Kroeg", translation: "Cafe - Pub" },
            { text: "Waar niemand hen hoort, kent of stoort.", translation: "Where no one hears, knows, or disturbs them." },
            { text: "Een goed excuus", translation: "A good excuse" },
          ]
        },
        {
          heading: "Diversen",
          items: [
            { text: "Inschakelen", translation: "To arrange and call someone" },
            { text: "Wildvreemd", translation: "Completely unknown" },
            { text: "Even oud", translation: "The same age" },
            { text: "Succes", translation: "Success" },
            { text: "Dit betekent / Dat betekent", translation: "This means / That means" },
          ]
        }
      ]
    },
    august11: {
      title: "Maandag 11 Augustus",
      sections: [
        {
          heading: "De vier werkwoorden voor spreken",
          items: [
            { text: "Praten (informeel gesprek)", translation: "To talk, converse" },
            { text: "Zeggen (specifieke uitspraak)", translation: "To say, tell" },
            { text: "Vertellen (uitgebreide informatie)", translation: "To tell a story or give detailed information" },
            { text: "Spreken (formeler dan praten, taalbeheersing)", translation: "To speak" },
          ]
        },
        {
          heading: "Plaatsen & Geografie",
          items: [
            { text: "HET park", translation: "The park" },
            { text: "In Libanon, IS HET‚Ä¶", translation: "In Lebanon, it is‚Ä¶" },
            { text: "Langs", translation: "Along" },
            { text: "ZIJN ER veel meren", translation: "Are there many lakes" },
            { text: "De plattegrond", translation: "The map" },
            { text: "Een riool", translation: "A sewer" },
            { text: "Het ongeluk was in het zuiden", translation: "The accident was in the south" },
            { text: "De plek", translation: "The place" },
            { text: "Groot bos", translation: "Large forest" },
            { text: "Wenen", translation: "Vienna" },
          ]
        },
        {
          heading: "Tijd & Frequenties",
          items: [
            { text: "We begonnen om 2 uur.", translation: "We started at 2 o‚Äôclock." },
            { text: "Tijdens de rest van de dag", translation: "During the rest of the day" },
            { text: "Niet ZO vaak", translation: "Not SO often" },
            { text: "Wanneer ik een ‚Ä¶. KOOP", translation: "When I buy a‚Ä¶" },
            { text: "Het voorjaar - Lente", translation: "Spring" },
            { text: "Najaar - Herfst", translation: "Autumn" },
            { text: "Vorig jaar BEN IK naar Wenen met de trein gegaan.", translation: "Last year I went to Vienna by train." },
          ]
        },
        {
          heading: "Mensen & Personen",
          items: [
            { text: "HIJ (neef)", translation: "He (cousin)" },
            { text: "Zij (nicht)", translation: "She (cousin)" },
            { text: "Een passagier", translation: "A passenger" },
            { text: "Ze waren in de war", translation: "They were confused" },
            { text: "Lost - Kwijt", translation: "Lost - disappeared" },
          ]
        },
        {
          heading: "Acties & Gebeurtenissen",
          items: [
            { text: "We hebben samen ontbeten, ‚Ä¶", translation: "We had breakfast together" },
            { text: "We ontbeten.", translation: "We had breakfast." },
            { text: "Stofzuigen", translation: "To vacuum" },
            { text: "Vandaag heb ik IN het park gechillt.", translation: "Today I chilled IN the park." },
            { text: "Na een hele sterke regenbui", translation: "After a very heavy rain shower" },
            { text: "Bereiken", translation: "To reach" },
            { text: "Was ontspoord", translation: "Had derailed" },
            { text: "Er zijn 3 mensen omgekomen en 40 gewond geraakt.", translation: "3 people died and 40 were injured." },
            { text: "Waardoor - Doordat", translation: "Because of what? - Because" },
            { text: "Zijn - gebracht", translation: "Are - brought" },
            { text: "Weg te takelen", translation: "To tow away" },
          ]
        },
        {
          heading: "Diversen & Grammatica",
          items: [
            { text: "Regels", translation: "Rules" },
            { text: "Dit recept", translation: "This recipe" },
            { text: "Zelf gebruik ik het nooit.", translation: "I myself never use it." },
            { text: "Asperge (franse uitspraak)", translation: "Asparagus (French pronunciation)" },
            { text: "Asperger (a disease; with the ‚Äòg‚Äô)", translation: "Asperger" },
          ]
        }
      ]
    },
    extra: {
      title: "Extra: Vruchten & Groenten",
      sections: [
        {
          heading: "Vruchten üçé",
          items: [
            { text: "De mango", translation: "A sweet, juicy fruit used in tropical dishes." },
            { text: "De ananas", translation: "A large, tropical fruit with a sweet and fresh taste." },
            { text: "De kiwi", translation: "A small, oval fruit with a hairy peel and green flesh." },
            { text: "De granaatappel", translation: "A round fruit filled with juicy, ruby-red seeds." },
            { text: "De avocado", translation: "Often seen as a vegetable, but botanically a fruit." },
            { text: "De vijg", translation: "A soft, sweet fruit with many small seeds." },
            { text: "De lychee", translation: "A small, exotic fruit with a pink peel and a sweet, juicy inside." },
            { text: "De papaja", translation: "A large, tropical fruit with orange flesh and a sweet taste." },
            { text: "De passievrucht", translation: "A purple fruit with a hard peel and jelly-like flesh with seeds." },
            { text: "De kaki", translation: "An orange fruit that looks like a tomato and is only edible when soft." },
            { text: "De braam", translation: "A small, dark fruit that grows on a bush." },
            { text: "De bosbes", translation: "A small, blue berry with a slightly sweet taste." },
            { text: "De framboos", translation: "A delicate, red berry." },
          ]
        },
        {
          heading: "Groenten ü•¶",
          items: [
            { text: "De artisjok", translation: "A plant whose flower bud is eaten." },
            { text: "De asperge", translation: "A long, white or green vegetable." },
            { text: "De aubergine", translation: "A purple, egg-shaped fruit often used in Mediterranean dishes." },
            { text: "De courgette", translation: "A green, elongated vegetable." },
            { text: "De pastinaak", translation: "A white root vegetable with a sweet, anise-like taste." },
            { text: "De pompoen", translation: "A large, orange fruit often eaten in autumn." },
            { text: "De prei", translation: "A long, green and white vegetable with a mild onion flavor." },
            { text: "De radijs", translation: "A small, red and spicy root vegetable." },
            { text: "De rucola", translation: "A type of lettuce with a peppery taste." },
            { text: "De venkel", translation: "A root vegetable with a strong anise flavor." },
          ]
        }
      ]
    }
  };

  const allQuizQuestions = [
    // Algemene woordenschat & grammatica
    { question: "Wat is de correcte spelling voor 'Together'?", options: ["Zamen", "Samen", "Saamen", "Saam"], answer: "Samen" },
    { question: "Wat betekent 'Verkouden'?", options: ["Verward zijn", "Moe zijn", "Een verkoudheid hebben", "Ziek zijn"], answer: "Een verkoudheid hebben" },
    { question: "Welk woord is formeler: 'Praten' of 'Spreken'?", options: ["Praten", "Spreken"], answer: "Spreken" },
    { question: "Wat is de Nederlandse vertaling voor 'apricot'?", options: ["Perzik", "Pruim", "Nectarine", "Abrikoos"], answer: "Abrikoos" },
    { question: "Wat betekent 'Wisselvallig weer'?", options: ["Regenachtig weer", "Veranderlijk weer", "Zonnig weer", "Koud weer"], answer: "Veranderlijk weer" },
    { question: "Welke groente heeft een zoete, anijsachtige smaak?", options: ["De prei", "De pastinaak", "De venkel", "De rucola"], answer: "De pastinaak" },
    { question: "Het woord 'plattegrond' betekent:", options: ["De vlakke grond", "De kaart", "Een riool", "De metro"], answer: "De kaart" },
    { question: "De zin 'thinking crazy' bestaat niet in het Nederlands. Wat is de juiste manier om zoiets te zeggen?", options: ["Gek denken", "Een gek plan hebben", "Denken gek", "Gekke gedachten"], answer: "Een gek plan hebben" },
    { question: "Hoe zeg je 'Last year I went to Vienna by train' correct?", options: ["Laatste jaar ik ga naar Wenen met de trein.", "Vorig jaar ik ben gegaan naar Wenen met de trein.", "Vorig jaar BEN IK naar Wenen met de trein gegaan.", "Vorige jaar ik ben naar Wenen gegaan met de trein."], answer: "Vorig jaar BEN IK naar Wenen met de trein gegaan." },
    { question: "Wat betekent 'Stofzuigen'?", options: ["Schoonmaken", "Wassen", "Stofzuigen", "Koken"], answer: "Stofzuigen" },
    { question: "Welke vrucht wordt vaak als groente gezien, maar is botanisch gezien een vrucht?", options: ["De papaja", "De vijg", "De avocado", "De ananas"], answer: "De avocado" },
    { question: "Wat is de correcte manier om te zeggen 'During the cooking'?", options: ["Tijdens DAT IK KOOK", "Tijdens het koken", "Terwijl dat ik kook", "Tijdens koken"], answer: "Tijdens het koken" },
    { question: "Welk werkwoord gebruik je voor een specifieke, directe mededeling?", options: ["Praten", "Zeggen", "Vertellen", "Spreken"], answer: "Zeggen" },
    { question: "Wat betekent 'Inschakelen'?", options: ["Aanzetten", "Uitzetten", "Iemand regelen en bellen", "Geloven"], answer: "Iemand regelen en bellen" },
    { question: "Het woord 'Kwijt' betekent:", options: ["Verloren (verdwenen)", "Gevonden", "Bewaard", "Opgepikt"], answer: "Verloren (verdwenen)" },
    { question: "Wat is de Nederlandse vertaling voor 'Changeable weather'?", options: ["Veranderend weer", "Wisselvallig weer", "Mooi weer", "Slecht weer"], answer: "Wisselvallig weer" },
    { question: "Welke vrucht is eetbaar als hij zacht is en lijkt op een tomaat?", options: ["De kaki", "De braam", "De lychee", "De bosbes"], answer: "De kaki" },
    { question: "Het Nederlandse woord voor 'Stage' is:", options: ["Toonzaal", "Scherm", "Podium", "Tribune"], answer: "Podium" },
    { question: "Wat betekent de zin 'Morgen ga ik het ervan NEMEN'?", options: ["Ik zal het morgen nemen.", "Morgen neem ik een pauze.", "Morgen ga ik er het beste van maken.", "Ik ga morgen niet."], answer: "Morgen ga ik er het beste van maken." },

    // Nieuwe vragen op basis van de notities
    { question: "Wat is de correcte vertaling voor 'to experience'?", options: ["Geloven", "Beleven", "Winnen", "Zeggen"], answer: "Beleven" },
    { question: "Welk woord is een synoniem voor 'meemaken'?", options: ["Vergeten", "Beleven", "Herinneren", "Praten"], answer: "Beleven" },
    { question: "Wat betekent de uitdrukking 'Er vandoor gaan'?", options: ["Weggaan", "Binnenkomen", "Blijven", "Vallen"], answer: "Weggaan" },
    { question: "In de zin 'een bezoek BIJ zijn oom', wat betekent 'bij'?", options: ["Met", "Naast", "Bij", "Tijdens"], answer: "Bij" },
    { question: "Wat is het meervoud van 'Stad'?", options: ["Staden", "Steden", "Stadjes", "Stadsen"], answer: "Steden" },
    { question: "De vrucht die aan een struik groeit en donker is, is de...", options: ["Braam", "Framboos", "Bosbes", "Pruim"], answer: "Braam" },
    { question: "Welke groente wordt vaak gebakken of gegrild?", options: ["De prei", "De aubergine", "De courgette", "De artisjok"], answer: "De courgette" },
    { question: "Wat is de correcte vertaling van 'He (cousin)'?", options: ["Hij (nicht)", "Zij (nicht)", "Hij (neef)", "Zij (neef)"], answer: "Hij (neef)" },
    { question: "Wat betekent 'Wildvreemd'?", options: ["Heel oud", "Helemaal onbekend", "Erg wild", "Een vreemde wildernis"], answer: "Helemaal onbekend" },
    { question: "Wat is een kenmerk van de 'rucola'?", options: ["Zoete smaak", "Sterke anijssmaak", "Peperachtige smaak", "Milde uiensmaak"], answer: "Peperachtige smaak" },
    { question: "Welke vrucht heeft een harige schil?", options: ["De ananas", "De kiwi", "De lychee", "De passievrucht"], answer: "De kiwi" },
    { question: "In de zin 'We hebben samen ontbeten', welk werkwoord wordt gebruikt?", options: ["Zeggen", "Praten", "Ontbijten", "Vertellen"], answer: "Ontbijten" },
    { question: "Wat is de Nederlandse vertaling voor 'The map'?", options: ["De kaart", "Het kaartje", "De plattegrond", "De straten"], answer: "De plattegrond" },
    { question: "Wat is de betekenis van 'bereiken'?", options: ["Weggaan", "Aankomen", "Bereiken", "Rijden"], answer: "Bereiken" },
  ];

  // Function to shuffle an array
  const shuffleArray = (array) => {
    let newArray = [...array];
    for (let i = newArray.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
    }
    return newArray;
  };

  // Function to start a new quiz
  const startNewQuiz = () => {
    // Shuffle all questions and take a random subset
    const shuffledQuestions = shuffleArray(allQuizQuestions);
    const quizSubset = shuffledQuestions.slice(0, 10); // Take 10 questions
    setQuizQuestions(quizSubset);
    setCurrentQuestionIndex(0);
    setScore(0);
    setShowResult(false);
    setSelectedAnswer(null);
    setCorrectAnswer(null);
    setView('quiz');
  };

  useEffect(() => {
    startNewQuiz();
  }, []);

  // Handle user's answer selection
  const handleAnswer = (answer) => {
    if (selectedAnswer !== null) return; // Prevent multiple clicks
    setIsAnimating(true);
    setSelectedAnswer(answer);
    const currentQuestion = quizQuestions[currentQuestionIndex];
    const isCorrect = answer === currentQuestion.answer;
    setCorrectAnswer(currentQuestion.answer);

    if (isCorrect) {
      setScore(prevScore => prevScore + 1);
    }
  };

  // Move to the next question
  const nextQuestion = () => {
    setIsAnimating(false);
    setSelectedAnswer(null);
    setCorrectAnswer(null);

    const nextIndex = currentQuestionIndex + 1;
    if (nextIndex < quizQuestions.length) {
      setCurrentQuestionIndex(nextIndex);
    } else {
      setShowResult(true);
    }
  };
  
  // Quiz and Notes views as inner components for clarity
  const NotesView = () => {
    const [openSections, setOpenSections] = useState({});

    const toggleSection = (sectionHeading) => {
      setOpenSections(prev => ({
        ...prev,
        [sectionHeading]: !prev[sectionHeading]
      }));
    };

    return (
      <div className="p-4 sm:p-8 space-y-8 animate-fade-in-up">
        {Object.entries(notesData).map(([key, data]) => (
          <div key={key} className="bg-white p-6 rounded-3xl shadow-xl border border-gray-200">
            <h2 className="text-3xl font-extrabold text-blue-800 mb-4 border-b-2 border-blue-200 pb-2 flex items-center">
              <Library className="mr-2 h-8 w-8 text-blue-500" />
              {data.title}
            </h2>
            {data.sections.map((section, index) => (
              <div key={index} className="mb-4">
                <button
                  onClick={() => toggleSection(section.heading)}
                  className="w-full flex items-center justify-between text-left p-4 bg-gray-50 rounded-2xl transition-all duration-300 hover:bg-gray-100 shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                >
                  <h3 className="text-2xl font-bold text-gray-700 flex items-center">
                    <Sparkles className="mr-2 h-6 w-6 text-yellow-500" />
                    {section.heading}
                  </h3>
                  <ChevronDown className={`transform transition-transform duration-300 ${openSections[section.heading] ? 'rotate-180' : 'rotate-0'}`} />
                </button>
                <div className={`overflow-hidden transition-max-h duration-500 ease-in-out ${openSections[section.heading] ? 'max-h-screen mt-2' : 'max-h-0'}`}>
                  <ul className="space-y-2 p-4 bg-gray-50 rounded-2xl mt-2 border border-gray-200">
                    {section.items.map((item, i) => (
                      <li key={i} className="flex flex-col p-3 bg-white rounded-xl transition-all duration-300 hover:bg-gray-50 shadow-sm">
                        <span className="text-lg font-semibold text-gray-800">{item.text}</span>
                        <span className="text-sm italic text-gray-500 mt-1">{item.translation}</span>
                      </li>
                    ))}
                  </ul>
                </div>
              </div>
            ))}
          </div>
        ))}
      </div>
    );
  };

  const QuizView = () => {
    const questionData = quizQuestions[currentQuestionIndex];
    const [shuffledOptions, setShuffledOptions] = useState([]);
    
    // Shuffle options once when the question changes
    useEffect(() => {
      if (questionData) {
        setShuffledOptions(shuffleArray(questionData.options));
      }
    }, [questionData]);

    if (showResult) {
      return (
        <div className="flex flex-col items-center justify-center h-full p-8 text-center animate-fade-in-up">
          <h2 className="text-5xl font-extrabold text-blue-800 mb-4">Quiz voltooid!</h2>
          <p className="text-2xl text-gray-600 mb-8">Je score is...</p>
          <div className="text-7xl font-black text-green-600 mb-8">{score} / {quizQuestions.length}</div>
          <button
            onClick={startNewQuiz}
            className="flex items-center px-8 py-4 bg-green-600 text-white font-bold rounded-full text-xl shadow-lg hover:bg-green-700 transition-all duration-300 transform hover:scale-105 active:scale-95"
          >
            <Repeat className="mr-3" /> Start een nieuwe quiz
          </button>
        </div>
      );
    }

    if (!questionData) {
      return <div className="text-center p-8 text-gray-500">Quiz aan het laden...</div>;
    }

    return (
      <div className="flex flex-col items-center justify-center h-full p-4 sm:p-8 animate-fade-in-up">
        <div className="w-full max-w-2xl bg-white rounded-3xl shadow-2xl p-6 sm:p-10 border border-gray-100">
          <div className="text-center mb-6">
            <span className="text-lg font-bold text-blue-600">Vraag {currentQuestionIndex + 1} van {quizQuestions.length}</span>
          </div>
          <h2 className="text-2xl sm:text-3xl font-extrabold text-gray-800 text-center mb-8">{questionData.question}</h2>
          <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
            {shuffledOptions.map((option, index) => (
              <button
                key={option}
                onClick={() => handleAnswer(option)}
                disabled={selectedAnswer !== null}
                className={`
                  p-4 rounded-xl border-2 font-semibold text-lg transition-all duration-300 flex items-center justify-between text-left
                  ${
                    selectedAnswer === null
                      ? 'bg-blue-50 text-blue-800 hover:bg-blue-100 hover:border-blue-300'
                      : option === questionData.answer
                      ? 'bg-green-100 text-green-800 border-green-500'
                      : option === selectedAnswer && option !== questionData.answer
                      ? 'bg-red-100 text-red-800 border-red-500'
                      : 'bg-gray-50 text-gray-400 border-gray-200 cursor-not-allowed'
                  }
                `}
              >
                <span>{option}</span>
                {selectedAnswer && (
                  option === questionData.answer
                    ? <Check className="text-green-500 ml-2" />
                    : option === selectedAnswer
                    ? <X className="text-red-500 ml-2" />
                    : null
                )}
              </button>
            ))}
          </div>
          {selectedAnswer !== null && (
            <div className="mt-8 text-center">
              <button
                onClick={nextQuestion}
                className="flex items-center mx-auto px-6 py-3 bg-blue-600 text-white font-bold rounded-full text-lg shadow-md hover:bg-blue-700 transition-all duration-300 transform hover:scale-105 active:scale-95"
              >
                Volgende vraag <Send className="ml-2" />
              </button>
            </div>
          )}
        </div>
      </div>
    );
  };

  // Main layout with navigation
  return (
    <div className="bg-gray-50 font-sans text-gray-800 min-h-screen">
      <div className="container mx-auto p-4 sm:p-8">
        <header className="flex flex-col sm:flex-row items-center justify-between p-6 bg-white rounded-3xl shadow-xl mb-8">
          <h1 className="text-4xl font-extrabold text-blue-800 mb-4 sm:mb-0">Nederlandse Studie-App üá≥üá±</h1>
          <div className="flex space-x-2">
            <button
              onClick={() => setView('notes')}
              className={`flex items-center px-6 py-3 rounded-full font-bold transition-all duration-300 ${view === 'notes' ? 'bg-blue-600 text-white shadow-lg' : 'bg-gray-100 text-gray-600 hover:bg-gray-200'}`}
            >
              <Library className="mr-2" /> Aantekeningen
            </button>
            <button
              onClick={startNewQuiz}
              className={`flex items-center px-6 py-3 rounded-full font-bold transition-all duration-300 ${view === 'quiz' ? 'bg-green-600 text-white shadow-lg' : 'bg-gray-100 text-gray-600 hover:bg-gray-200'}`}
            >
              <Sparkles className="mr-2" /> Start quiz
            </button>
          </div>
        </header>

        <main>
          {view === 'notes' ? <NotesView /> : <QuizView />}
        </main>
      </div>
    </div>
  );
};

export default App;
